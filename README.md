# LruCache Benchmark - Android画像処理キャッシュ効果検証

AndroidのLruCacheを使用した画像処理のパフォーマンス比較アプリです。

## 概要

このアプリは、重い画像処理（超解像、シャープネス、ガウシアンブラー）に対して、LruCacheを使用した場合としない場合でどれだけ処理時間が変わるかを測定します。

## ベンチマーク結果

### テスト環境
- **デバイス**: WAVE8NEU00000452
- **画像サイズ**: 953x586 (東京夜景画像)
- **繰り返し回数**: 5回
- **キャッシュヒット率**: 80% (5回中4回がキャッシュヒット)

### 結果サマリー

| 処理 | キャッシュなし | キャッシュあり | 高速化倍率 | 節約時間 |
|------|---------------|---------------|-----------|---------|
| **超解像 (2x)** | 10,555ms | 2,097ms | **5.0倍** | 8,458ms |
| シャープネス | 482ms | 91ms | **5.3倍** | 391ms |
| ガウシアンブラー | 5,212ms | 1,018ms | **5.1倍** | 4,194ms |

### 総合結果
- **合計節約時間**: 13,043ms（約13秒）
- **平均高速化倍率**: 5.15倍

## LruCacheの効果

### なぜ5倍の高速化が実現できたか

1. **キャッシュヒット時は処理をスキップ**: 同じ画像に対する同じ処理結果がキャッシュにある場合、重い画像処理を完全にスキップしてキャッシュから直接取得

2. **繰り返しアクセスのシナリオ**:
   - 5回のアクセス中、1回目はキャッシュミス（処理実行）
   - 2〜5回目はキャッシュヒット（処理スキップ）
   - 結果として平均処理時間が約1/5に

3. **処理が重いほど効果大**:
   - 超解像処理（バイキュービック補間で2倍拡大）: 10秒→2秒
   - ガウシアンブラー（11x11カーネル）: 5秒→1秒

### 実用的なユースケース

- **画像ギャラリーアプリ**: サムネイル生成結果をキャッシュ
- **フォトエディター**: フィルター適用結果をキャッシュ（Undo/Redo時に即座に復元）
- **カメラアプリ**: プレビュー画像の加工結果をキャッシュ

## プロジェクト構成

```
app/src/main/java/com/example/lrucache/
├── MainActivity.kt          # Compose UI
├── BenchmarkViewModel.kt    # ベンチマークロジック
├── ImageProcessor.kt        # 画像処理（超解像、シャープネス、ブラー）
└── ImageCacheManager.kt     # LruCacheラッパー
```

## 画像処理の詳細

### 超解像処理 (2x)
- バイキュービック補間（Catmull-Rom）
- 入力画像を2倍の解像度に拡大
- 最も計算量が多い処理

### シャープネス
- アンシャープマスクフィルター
- 3x3カーネルによるエッジ強調

### ガウシアンブラー
- ガウス関数によるぼかし処理
- 11x11カーネル（radius=5）

## LruCacheの実装

```kotlin
class ImageCacheManager {
    // 利用可能メモリの1/8をキャッシュに使用
    private val maxMemory = (Runtime.getRuntime().maxMemory() / 1024).toInt()
    private val cacheSize = maxMemory / 8

    private val memoryCache = object : LruCache<String, Bitmap>(cacheSize) {
        override fun sizeOf(key: String, bitmap: Bitmap): Int {
            return bitmap.byteCount / 1024  // KB単位
        }
    }
}
```

## ビルド方法

```bash
./gradlew assembleDebug
adb install -r app/build/outputs/apk/debug/app-debug.apk
```

## 使い方

1. アプリを起動
2. 繰り返し回数をスライダーで設定（1〜10回）
3. 「ベンチマーク開始」ボタンをタップ
4. 結果が表示される

## 結論

LruCacheを活用することで、同じ画像に対する繰り返し処理のシナリオで**約5倍の高速化**が実現できました。特に処理が重い超解像処理では、**10秒の処理が2秒に短縮**されました。

画像処理アプリでは、ユーザーが同じ画像を繰り返し閲覧・編集することが多いため、LruCacheによるキャッシュ戦略は非常に効果的です。

## ライセンス

MIT License
